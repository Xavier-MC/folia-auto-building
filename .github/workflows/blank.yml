# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v3

      # Runs a single command using the runners shell
      - name: Run a one-line script
        run: echo Hello, world!

      # Runs a set of commands using the runners shell
      - name: Run a multi-line script
        run: |
          echo Add other actions to build,
          echo test, and deploy your project.
# 这个文件名为build.yml，放在.github/workflows文件夹中
# 这个工作流会在每次有新的推送到master分支时触发
name: Build Folia
on:
  push:
    branches: [ master ]

# 这个工作流定义了一个名为build的任务
jobs:
  build:
    # 这个任务运行在ubuntu-latest环境中
    runs-on: ubuntu-latest

    # 这个任务的步骤如下：
    steps:
      # 第一步：使用actions/checkout@v2动作来拉取Folia的源代码
      - name: Checkout Folia
        uses: actions/checkout@v2
        with:
          repository: PaperMC/Folia # Folia的仓库名
          ref: master # Folia的分支名

      # 第二步：使用actions/setup-java@v2动作来安装Java环境
      - name: Setup Java
        uses: actions/setup-java@v2
        with:
          distribution: 'adopt' # Java的发行版
          java-version: '16' # Java的版本

      # 第三步：运行./gradlew applyPatches命令来应用补丁
      - name: Apply patches
        run: ./gradlew applyPatches

      # 第四步：运行./gradlew reobfJar命令来编译Folia
      - name: Build Folia
        run: ./gradlew reobfJar

      # 第五步：使用actions/upload-artifact@v2动作来上传编译好的jar文件
      - name: Upload artifact
        uses: actions/upload-artifact@v2
        with:
          name: folia.jar # jar文件的名字
          path: Paper-Server/build/libs/folia-paperclip.jar # jar文件的路径

